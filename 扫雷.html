<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å±•ä¼šçˆ†å“æ‰«é›· - ä¸“ä¸šé€»è¾‘ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #ff4757;
            --safe-bg: #ffffff;
            --cell-size: 55px;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: #f7f1e3;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding-top: 30px;
        }

        h1 { color: #d35400; margin-bottom: 5px; }
        .desc { color: #7f8c8d; margin-bottom: 20px; }

        /* æ¸¸æˆåŒºåŸŸ */
        #game-container {
            position: relative;
            background: #bdc3c7;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(8, var(--cell-size));
            grid-gap: 2px;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background: #ecf0f1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            border-radius: 2px;
            position: relative;
            transition: background 0.2s;
        }

        .cell:hover:not(.revealed) { background: #d1ccc0; }
        .cell.revealed {
            background: var(--safe-bg);
            cursor: default;
        }

        /* æ•°å­—é¢œè‰² */
        .n-1 { color: #3498db; }
        .n-2 { color: #2ecc71; }
        .n-3 { color: #e74c3c; }
        .n-4 { color: #9b59b6; }
        .n-5 { color: #e67e22; }
        .n-6 { color: #1abc9c; }

        .heart { 
            background: #ff7675 !important; 
            font-size: 24px;
            animation: heartPop 0.5s ease-out;
        }
        @keyframes heartPop {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* çˆ†å“å¼¹çª— */
        #product-modal {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            text-align: center;
            z-index: 2000;
            width: 300px;
        }
        #product-modal img {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        /* ç»“æŸå¼¹çª— */
        #end-modal {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            text-align: center;
            z-index: 1000;
            width: 280px;
        }

        button {
            margin-top: 15px;
            padding: 10px 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>

    <h1>ğŸ· çˆ†å“æ‰«é›·å¤§ä½œæˆ˜ ğŸ«</h1>
    <p class="desc">æ’é›·æˆåŠŸï¼Œè§£é”å¯¹åº”çˆ†å“ï¼</p>

    <div id="game-container">
        <div id="grid"></div>
    </div>

    <!-- ç”¨äºå±•ç¤ºå•ä¸ªçˆ†å“çš„å¼¹çª— -->
    <div id="product-modal">
        <h3>æ’é›·æˆåŠŸï¼å‘ç°çˆ†å“</h3>
        <img id="product-modal-img" src="" alt="çˆ†å“">
        <p id="product-modal-desc"></p>
        <button onclick="closeProductModal()">ç»§ç»­æ¸¸æˆ</button>
    </div>

    <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
    <div id="end-modal">
        <h2 id="end-modal-title">æ¸¸æˆç»“æŸ</h2>
        <p id="end-modal-msg"></p>
        <button onclick="initGame()">é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        const rows = 8;
        const cols = 8;
        const heartCount = 7;
        
        // ã€è‡ªå®šä¹‰çˆ†å“ä¿¡æ¯ï¼šæ¯ä¸ªé›·å¯¹åº”ä¸€ä¸ªçˆ†å“ã€‘
        const productData = [
            { 
                imgUrl: "https://static.foodtalks.cn/image/post/39292636ab9ef3095f2aeb305fbd4aa858fa.png",
                description: "æ–°å“A - åŒ å¿ƒé…¿é€ "
            },
            { 
                imgUrl: "https://static.foodtalks.cn/image/post/d83bb69c3896860cf34acbe6283036f7.webp",
                description: "çƒ­é”€B - äººæ°”ä¹‹é€‰"
            },
            { 
                imgUrl: "https://static.foodtalks.cn/image/post/428ead289d5134670e8b97ad32930901abc4.png",
                description: "ç‰¹é¥®C - æ¸…çˆ½ä½“éªŒ"
            },
            { 
                imgUrl: "https://mmbiz.qpic.cn/mmbiz_png/8XP6AJS4BwYiakF6PsuuOgpUiciblRqEicHXB2Gqmvf1HbhkwgZSWMvJC0ttZq8ORC5jqerrWR83V9QqlPDWCrE1tA/640?wx_fmt=png&from=appmsg",
                description: "é›¶é£ŸD - ç¾å‘³äº«å—"
            },
            { 
                imgUrl: "https://static.foodtalks.cn/image/post/637725d5ea752564254abc3d35d27d7e4389.png",
                description: "ç”œå“E - ç”œèœœè¯±æƒ‘"
            },
            { 
                imgUrl: "https://static.foodtalks.cn/image/post/a7319cff7b303b46088a59cc0c08ff4d.jpg",
                description: "é›¶é£Ÿ - è”åè–¯ç‰‡"
            },
            { 
                imgUrl: "https://static.foodtalks.cn/image/post/7a432b003d9c1ed03ab2e98e5e533a11.png",
                description: "é›¶é£Ÿ - "
            }
        ];

        let board = [];
        let hearts = []; // å­˜å‚¨æ‰€æœ‰é›·çš„ä¿¡æ¯
        let gridElement = document.getElementById('grid');
        let safeCellsRemaining = rows * cols - heartCount; // å‰©ä½™å®‰å…¨æ ¼è®¡æ•°

        function initGame() {
            gridElement.innerHTML = '';
            board = [];
            hearts = [];
            safeCellsRemaining = rows * cols - heartCount;
            document.getElementById('product-modal').style.display = 'none';
            document.getElementById('end-modal').style.display = 'none';

            // 1. åˆå§‹åŒ–ç©ºæ£‹ç›˜
            for (let r = 0; r < rows; r++) {
                board[r] = [];
                for (let c = 0; c < cols; c++) {
                    board[r][c] = { 
                        isHeart: false, 
                        revealed: false, 
                        count: 0,
                        heartId: null,
                        safeForHearts: []
                    };
                }
            }

            // 2. éšæœºå¸ƒé›·ï¼Œå¹¶åˆå§‹åŒ–æ¯ä¸ªé›·çš„æ•°æ®ç»“æ„
            let productIndex = 0;
            for (let i = 0; i < heartCount; i++) {
                let placed = false;
                while (!placed) {
                    let r = Math.floor(Math.random() * rows);
                    let c = Math.floor(Math.random() * cols);
                    if (!board[r][c].isHeart) {
                        board[r][c].isHeart = true;
                        board[r][c].heartId = i;
                        
                        // ä¸ºæ­¤é›·åˆ›å»ºä¸€ä¸ªæ•°æ®å¯¹è±¡
                        let heartObj = {
                            id: i,
                            r: r,
                            c: c,
                            product: productData[productIndex % productData.length],
                            neighborSafeCells: [], // å­˜å‚¨å‘¨å›´8ä¸ªå®‰å…¨æ ¼çš„åæ ‡
                            cleared: false
                        };
                        
                        // æ‰¾å‡ºå¹¶è®°å½•æ­¤é›·å‘¨å›´8æ ¼ä¸­çš„æ‰€æœ‰å®‰å…¨æ ¼
                        for (let dr = -1; dr <= 1; dr++) {
                            for (let dc = -1; dc <= 1; dc++) {
                                if (dr === 0 && dc === 0) continue;
                                let nr = r + dr;
                                let nc = c + dc;
                                if (nr >= 0 && nr < rows && nc >= 0 && nc < cols) {
                                    // è®°å½•è¿™ä¸ªå®‰å…¨æ ¼å±äºå½“å‰é›·
                                    board[nr][nc].safeForHearts.push(i);
                                    // å¦‚æœè¿™ä¸ªé‚»æ ¼ä¸æ˜¯é›·ï¼Œåˆ™åŠ å…¥åˆ°é›·çš„â€œå¾…æ’æŸ¥åˆ—è¡¨â€
                                    if (!board[nr][nc].isHeart) {
                                        heartObj.neighborSafeCells.push({r: nr, c: nc});
                                    }
                                }
                            }
                        }
                        
                        hearts.push(heartObj);
                        productIndex++;
                        placed = true;
                    }
                }
            }

            // 3. è®¡ç®—æ¯ä¸ªå®‰å…¨æ ¼å‘¨å›´çš„é›·æ•°
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (!board[r][c].isHeart) {
                        board[r][c].count = countNeighbors(r, c);
                    }
                }
            }

            // 4. æ¸²æŸ“ç•Œé¢
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    cell.addEventListener('click', () => revealCell(r, c, false));
                    gridElement.appendChild(cell);
                    board[r][c].element = cell;
                }
            }
        }

        function countNeighbors(r, c) {
            let count = 0;
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    let nr = r + i;
                    let nc = c + j;
                    if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && board[nr][nc].isHeart) {
                        count++;
                    }
                }
            }
            return count;
        }

        // ==========ã€æ ¸å¿ƒä¿®å¤éƒ¨åˆ†ï¼šä¿®æ”¹äº†å‡½æ•°ç­¾åå’Œé€»è¾‘ã€‘==========
        function revealCell(r, c, isRecursiveCall) {
            let cellData = board[r][c];
            if (cellData.revealed) return;

            cellData.revealed = true;
            cellData.element.classList.add('revealed');

            if (cellData.isHeart) {
                // ç›´æ¥ç‚¹ä¸­é›·ï¼Œæ¸¸æˆç»“æŸ
                cellData.element.innerHTML = 'â¤ï¸';
                cellData.element.classList.add('heart');
                gameOver(false, 'ä½ è¢«çˆ±å¿ƒå‡»ä¸­å•¦ï¼è¯·é‡æ–°å¼€å§‹å§~');
            } else {
                // ç‚¹ä¸­å®‰å…¨æ ¼
                safeCellsRemaining--;
                
                // æ˜¾ç¤ºæ•°å­—
                if (cellData.count > 0) {
                    cellData.element.innerHTML = `<span class="number-text n-${cellData.count}">${cellData.count}</span>`;
                } else {
                    // å¦‚æœæ˜¯æ•°å­—0ï¼Œè‡ªåŠ¨å±•å¼€ä¸€ç‰‡ï¼ˆæ ‡è®°ä¸ºé€’å½’è°ƒç”¨ï¼‰
                    expandEmpty(r, c);
                }

                // ã€å…³é”®ä¿®å¤ã€‘åªåœ¨ç©å®¶ä¸»åŠ¨ç‚¹å‡»ï¼ˆéé€’å½’å±•å¼€ï¼‰æ—¶ï¼Œæ‰è§¦å‘æœ€ç»ˆçš„ç»Ÿä¸€æ£€æŸ¥
                if (!isRecursiveCall) {
                    checkForNewlyClearedHearts();
                }

                // æ£€æŸ¥æ˜¯å¦æ¸¸æˆèƒœåˆ©
                if (safeCellsRemaining === 0) {
                    gameOver(true, 'æ­å–œï¼æ‰€æœ‰çˆ†å“åŒºåŸŸå‡å·²å®‰å…¨æ’æŸ¥å®Œæ¯•ï¼');
                }
            }
        }

        function expandEmpty(r, c) {
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    let nr = r + i;
                    let nc = c + j;
                    if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && !board[nr][nc].revealed) {
                        if (!board[nr][nc].isHeart) {
                            // é€’å½’å±•å¼€æ—¶ï¼Œæ ‡è®°ä¸º true
                            revealCell(nr, nc, true);
                        }
                    }
                }
            }
        }
        // ==========ã€æ ¸å¿ƒä¿®å¤éƒ¨åˆ†ç»“æŸã€‘==========

        // ==========ã€æ–°å¢ï¼šæ‰¹é‡æ£€æŸ¥ä¸å¤„ç†å‡½æ•°ã€‘==========
        function checkForNewlyClearedHearts() {
            let newlyCleared = [];
            
            for (let heart of hearts) {
                if (!heart.cleared && isHeartCleared(heart)) {
                    heart.cleared = true;
                    newlyCleared.push(heart);
                }
            }
            
            if (newlyCleared.length > 0) {
                processClearedHearts(newlyCleared);
            }
        }
        
        function isHeartCleared(heart) {
            for (let safeCell of heart.neighborSafeCells) {
                if (!board[safeCell.r][safeCell.c].revealed) {
                    return false;
                }
            }
            return heart.neighborSafeCells.length > 0;
        }
        
        function processClearedHearts(heartArray) {
            for (let heart of heartArray) {
                let heartCell = board[heart.r][heart.c];
                heartCell.revealed = true;
                heartCell.element.innerHTML = 'â¤ï¸';
                heartCell.element.classList.add('revealed', 'heart');
            }
            
            showMultipleProductsModal(heartArray);
        }
        
        function showMultipleProductsModal(heartArray) {
            const modal = document.getElementById('product-modal');
            
            let title = heartArray.length === 1 ? 
                'æ’é›·æˆåŠŸï¼å‘ç°çˆ†å“' : 
                `æ’é›·æˆåŠŸï¼å‘ç° ${heartArray.length} ä¸ªçˆ†å“`;
            
            let content = `<h3>${title}</h3>`;
            
            heartArray.forEach(heart => {
                content += `
                <div style="margin: 15px 0;">
                    <img src="${heart.product.imgUrl}" alt="çˆ†å“" 
                         style="width: 100%; max-height: 150px; object-fit: contain; border-radius: 8px;">
                    <p style="margin: 8px 0;">${heart.product.description}</p>
                </div>
                `;
            });
            
            content += `<button onclick="closeProductModal()">ç»§ç»­æ¸¸æˆ</button>`;
            
            modal.innerHTML = content;
            modal.style.display = 'block';
        }
        // ==========ã€æ–°å¢å‡½æ•°ç»“æŸã€‘==========

        function closeProductModal() {
            document.getElementById('product-modal').style.display = 'none';
        }

        function gameOver(isWin, message) {
            const modal = document.getElementById('end-modal');
            modal.style.display = 'block';
            document.getElementById('end-modal-title').innerText = isWin ? "ğŸ† æŒ‘æˆ˜æˆåŠŸï¼" : "ğŸ’¥ æ¸¸æˆç»“æŸ";
            document.getElementById('end-modal-msg').innerText = message;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>